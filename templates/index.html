<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>ECG Analyzer - Heart Disease Detection</title>
    <link rel="icon" href="https://img.icons8.com/ios-filled/50/6610f2/heart-with-pulse.png" type="image/png">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.css" rel="stylesheet">
    <link href="static/style.css" rel="stylesheet">
</head>
<body>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="#">
                <img src="https://img.icons8.com/ios-filled/50/ffffff/heart-with-pulse.png" alt="ECG Logo" class="navbar-logo">
                ECG Analyzer
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="#about">About Heart Disease</a></li>
                    <li class="nav-item"><a class="nav-link" href="#upload">Analyze ECG</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero">
        <div class="container position-relative">
            <h1>Detect Heart Anomalies from ECG Signal</h1>
            <p>Advanced AI-powered ECG analysis for early detection of heart rhythm abnormalities</p>
        </div>
        <svg class="hero-wave" viewBox="0 0 1440 80" fill="none" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none">
            <path d="M0,40 C360,70 1080,10 1440,40 L1440,80 L0,80 Z" fill="white"/>
        </svg>
    </section>

    <!-- About Heart Disease Section -->
    <section id="about" class="about-section py-5">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <h2 class="section-title text-center mb-5">Understanding Heart Disease</h2>
                </div>
            </div>
            <div class="row g-4">
                <div class="col-md-4">
                    <div class="info-card">
                        <div class="info-icon">‚ù§Ô∏è</div>
                        <h4>What is Heart Disease?</h4>
                        <p>Heart disease refers to various conditions affecting the heart, including coronary artery disease, arrhythmias, and heart failure. Early detection through ECG analysis can help prevent serious complications.</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="info-card">
                        <div class="info-icon">üìä</div>
                        <h4>What is an ECG?</h4>
                        <p>An Electrocardiogram (ECG) records the electrical activity of your heart. It helps detect irregular heartbeats, blocked arteries, and other heart problems by analyzing the heart's rhythm patterns.</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="info-card">
                        <div class="info-icon">‚ö†Ô∏è</div>
                        <h4>Common Symptoms</h4>
                        <p>Watch for chest pain, shortness of breath, dizziness, irregular heartbeat, fatigue, or fainting. If you experience these symptoms, consult a healthcare professional immediately.</p>
                    </div>
                </div>
            </div>
            <div class="row mt-4">
                <div class="col-12">
                    <div class="prevention-card">
                        <h4>Prevention Tips</h4>
                        <div class="row mt-3">
                            <div class="col-md-6">
                                <ul class="prevention-list">
                                    <li>‚úÖ Maintain a healthy diet rich in fruits and vegetables</li>
                                    <li>‚úÖ Exercise regularly (at least 150 minutes per week)</li>
                                    <li>‚úÖ Avoid smoking and limit alcohol consumption</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <ul class="prevention-list">
                                    <li>‚úÖ Manage stress through relaxation techniques</li>
                                    <li>‚úÖ Monitor blood pressure and cholesterol levels</li>
                                    <li>‚úÖ Get regular health check-ups</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Upload Card -->
    <section id="upload" class="upload-section py-5">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-10">
                    <div class="card card-upload">
                        <h3 class="mb-4 text-center text-primary">Upload ECG Signal for Analysis</h3>
                        <form method="POST" enctype="multipart/form-data" autocomplete="off">
                            <div class="mb-3 text-start">
                                <label for="file-upload" class="form-label">Select ECG File (.dat or .csv)</label>
                                <input class="form-control" id="file-upload" type="file" name="file" accept=".dat,.csv" required aria-label="ECG file">
                                <small class="form-text text-muted">Supported formats: MIT-BIH (.dat) or CSV files containing ECG signal data</small>
                            </div>
                            <div class="d-grid">
                                <button type="submit" class="btn btn-custom">Analyze ECG Signal</button>
                            </div>
                        </form>

                        {% if error %}
                            <div class="alert alert-danger mt-4" role="alert">
                                <strong>‚ö†Ô∏è Error:</strong> {{ error }}
                            </div>
                        {% endif %}
                        
                        {% if prediction and prediction != '' %}
                            <!-- Prediction Result -->
                            <div class="result-container mt-5">
                                <div class="result-header {% if prediction == 'Normal' %}result-normal{% else %}result-abnormal{% endif %}">
                                    <h4 class="mb-2">
                                        {% if prediction == 'Normal' %}
                                            ‚úÖ Normal ECG Signal
                                        {% else %}
                                            ‚ö†Ô∏è Abnormal ECG Signal Detected
                                        {% endif %}
                                    </h4>
                                    {% if probability %}
                                        <div class="confidence-badge">
                                            Confidence: <strong>{{ "%.2f"|format(probability * 100) }}%</strong>
                                        </div>
                                    {% endif %}
                                </div>

                                <!-- Show Visualization Button -->
                                {% if ecg_plot_url and ecg_plot_url != '' %}
                                    <div class="text-center mt-4">
                                        <button type="button" class="btn btn-outline-primary btn-lg" id="showVisualBtn" onclick="toggleVisualization()">
                                            <span class="icon">üìà</span> Show ECG Visualization
                                        </button>
                                    </div>

                                    <!-- ECG Visualization (Hidden by default) -->
                                    <div class="ecg-visualization mt-4" id="ecgVisualization" style="display: none;">
                                        <h5 class="section-subtitle mb-3">
                                            <span class="icon">üìà</span> ECG Signal Visualization
                                        </h5>
                                        <div class="ecg-plot-container">
                                            <img src="{{ ecg_plot_url }}" alt="ECG Signal" class="ecg-plot-img">
                                        </div>
                                        <div class="ecg-explanation mt-3">
                                            <p><strong>Understanding the ECG Waveform:</strong></p>
                                            <ul>
                                                <li><strong>P Wave:</strong> Represents atrial contraction (upper chambers)</li>
                                                <li><strong>QRS Complex:</strong> Shows ventricular contraction (main pumping chambers)</li>
                                                <li><strong>T Wave:</strong> Indicates ventricular relaxation</li>
                                                <li><strong>Irregular Patterns:</strong> May indicate arrhythmias or other heart conditions</li>
                                            </ul>
                                        </div>
                                    </div>
                                {% endif %}

                                <!-- Actionable Advice -->
                                {% if advice %}
                                    <div class="advice-section mt-4">
                                        <h5 class="section-subtitle mb-3">
                                            <span class="icon">üí°</span> Recommended Actions
                                        </h5>
                                        <div class="alert alert-{% if advice.urgency == 'High' %}danger{% elif advice.urgency == 'Moderate' %}warning{% else %}info{% endif %} alert-actionable">
                                            <h6><strong>Urgency Level: {{ advice.urgency }}</strong></h6>
                                            <p class="mb-3">{{ advice.explanation }}</p>
                                            <hr>
                                            <h6 class="mb-3"><strong>What You Should Do:</strong></h6>
                                            <ol class="action-list">
                                                {% for action in advice.actions %}
                                                    <li>{{ action }}</li>
                                                {% endfor %}
                                            </ol>
                                            <div class="disclaimer mt-3">
                                                <small><strong>‚ö†Ô∏è Important Disclaimer:</strong> This analysis is for informational purposes only and should not replace professional medical advice. Always consult with a qualified healthcare provider for diagnosis and treatment.</small>
                                            </div>
                                        </div>
                                    </div>
                                {% endif %}
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="mt-auto">
        <div class="container">
            <div class="footer-links mb-2">
                <a href="https://github.com/reday321/Heart-Anomalies" target="_blank" rel="noopener">GitHub</a>
                <span class="mx-2">|</span>
                <a href="#about">About</a>
                <span class="mx-2">|</span>
                <a href="#">Privacy Policy</a>
            </div>
            <p>¬© 2025 ECG Analyzer. This tool is for educational and informational purposes only.</p>
            <p class="disclaimer-text"><small>Not a substitute for professional medical advice, diagnosis, or treatment.</small></p>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });
        });

        // Toggle ECG Visualization
        function toggleVisualization() {
            const visualization = document.getElementById('ecgVisualization');
            const button = document.getElementById('showVisualBtn');
            
            if (visualization && button) {
                if (visualization.style.display === 'none' || visualization.style.display === '') {
                    visualization.style.display = 'block';
                    button.innerHTML = '<span class="icon">üìà</span> Hide ECG Visualization';
                    button.classList.remove('btn-outline-primary');
                    button.classList.add('btn-primary');
                    // Scroll to visualization
                    visualization.scrollIntoView({ behavior: 'smooth', block: 'start' });
                } else {
                    visualization.style.display = 'none';
                    button.innerHTML = '<span class="icon">üìà</span> Show ECG Visualization';
                    button.classList.remove('btn-primary');
                    button.classList.add('btn-outline-primary');
                }
            }
        }

        // Force clear any cached data on page load
        window.addEventListener('load', function() {
            // Clear any form data that might be cached
            const form = document.querySelector('form');
            if (form) {
                form.reset();
            }
            
            // Clear any localStorage or sessionStorage if needed
            try {
                sessionStorage.removeItem('prediction');
                sessionStorage.removeItem('probability');
            } catch(e) {
                // Ignore errors
            }
        });
        
        // Prevent browser back/forward cache
        window.addEventListener('pageshow', function(event) {
            if (event.persisted) {
                // Page was loaded from cache, force reload
                window.location.reload();
            }
        });
    </script>
</body>
</html>
